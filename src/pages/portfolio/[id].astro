---
import { getCollection, render } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { Icon } from "astro-icon/components";
import { Image } from "astro:assets";
import PortfolioItems from "../../components/PortfolioItems.astro";
import RelatedPosts from "../../components/RelatedPosts.astro";

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
    const items = await getCollection("portfolio");
    return items.map((item) => ({
        params: { id: item.id },
        props: { item },
    }));
}

// 2. For your template, you can get the entry directly from the prop
const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/*.{jpeg,jpg,png,gif}');
const { item } = Astro.props;
const { Content } = await render(item);
const imgSrc = images[item.data.img] ?? item.data.img;
---

<Layout collectionItem={item}>
    <div class="flex flex-wrap justify-between gap-4" data-pagefind-body>
		<section id={item.id} class="prose prose-neutral dark:prose-invert">
			<div>
				<a href="/portfolio">
					<Icon class="inline" title="arrow-left" name="lineicons:arrow-left" />
					back to projects
				</a>
			</div>
			<h1 data-pagefind-meta="title">
				{item.data.title}
			</h1>
			<div class="mb-2 flex gap-2">
				{item.data.tags.map((tag) => (
					<div class="shadow-square border p-1">{tag}</div>
				))}
			</div>
			<Image
				src={typeof imgSrc === "function" ? imgSrc() : imgSrc}
				alt={item.data.img_alt}
				loading="eager"
				width={500}
				height={500}
				class="shadow-square mb-2 w-full border"
			/>
			<Content />
			<hr />
		</section>
		
		<aside id="related_more" class="w-sm">
			{item.data.related && (
				<h2 class="mb-2 text-2xl font-semibold">Related Posts</h2>
				<RelatedPosts item={item} />
				<br/>
			)}
			<h2 class="mb-2 text-2xl font-semibold">More</h2>
			<PortfolioItems count={3} ignore_id={item.id} />
		</aside>
    </div>
</Layout>
